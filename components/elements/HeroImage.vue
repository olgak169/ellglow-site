<template>
  <div class="hero_home-img" aria-hidden="true">
    <div class="text-blob" ref="textBlob">
      <p>EllGlow</p>
      <p>EllGlow</p>
      <p>EllGlow</p>
    </div>
    <svg
      viewBox="0 0 600 750"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      id="svgMask"
    >
      <defs>
        <mask id="mask-group">
          <g id="circlesGroup" ref="circlesGroup">
            <g id="group-01">
              <path
                d="M75 150C55.1088 150 36.0322 142.098 21.967 128.033C7.90176 113.968 -5.53337e-07 94.8912 0 75C5.53337e-07 55.1088 7.90176 36.0322 21.967 21.967C36.0322 7.90176 55.1088 -2.37201e-07 75 0V75V150Z"
                fill="white"
              />
              <path
                d="M150 150C130.109 150 111.032 142.098 96.967 128.033C82.9018 113.968 75 94.8912 75 75C75 55.1088 82.9018 36.0322 96.967 21.967C111.032 7.90176 130.109 -2.37201e-07 150 0V75V150Z"
                fill="white"
              />
              <path
                d="M150 225C150 266.421 116.421 300 75 300C33.5786 300 0 266.421 0 225C0 183.579 33.5786 150 75 150C116.421 150 150 183.579 150 225Z"
                fill="white"
              />
              <path
                d="M150 375C150 416.421 116.421 450 75 450C33.5786 450 0 416.421 0 375C0 333.579 33.5786 300 75 300C116.421 300 150 333.579 150 375Z"
                fill="white"
              />
              <path
                d="M150 525C150 566.421 116.421 600 75 600C33.5786 600 0 566.421 0 525C0 483.579 33.5786 450 75 450C116.421 450 150 483.579 150 525Z"
                fill="white"
              />
              <path
                d="M150 675C150 684.849 148.06 694.602 144.291 703.701C140.522 712.801 134.997 721.069 128.033 728.033C121.069 734.997 112.801 740.522 103.701 744.291C94.6018 748.06 84.8491 750 75 750C65.1509 750 55.3982 748.06 46.2987 744.291C37.1993 740.522 28.9314 734.997 21.967 728.033C15.0026 721.069 9.47814 712.801 5.70903 703.701C1.93993 694.602 -8.61039e-07 684.849 0 675L75 675H150Z"
                fill="white"
              />
              <path
                d="M150 600C150 609.849 148.06 619.602 144.291 628.701C140.522 637.801 134.997 646.069 128.033 653.033C121.069 659.997 112.801 665.522 103.701 669.291C94.6018 673.06 84.8491 675 75 675C65.1509 675 55.3982 673.06 46.2987 669.291C37.1993 665.522 28.9314 659.997 21.967 653.033C15.0026 646.069 9.47814 637.801 5.70903 628.701C1.93993 619.602 -8.61039e-07 609.849 0 600L75 600H150Z"
                fill="white"
              />
            </g>
            <g id="group-02" class="circles">
              <path
                d="M300 75C300 116.421 266.421 150 225 150C183.579 150 150 116.421 150 75C150 33.5786 183.579 0 225 0C266.421 0 300 33.5786 300 75Z"
                fill="white"
              />
              <path
                d="M300 225C300 266.421 266.421 300 225 300C183.579 300 150 266.421 150 225C150 183.579 183.579 150 225 150C266.421 150 300 183.579 300 225Z"
                fill="white"
              />
              <path
                d="M300 375C300 416.421 266.421 450 225 450C183.579 450 150 416.421 150 375C150 333.579 183.579 300 225 300C266.421 300 300 333.579 300 375Z"
                fill="white"
              />
              <path
                d="M225 450C205.109 450 186.032 457.902 171.967 471.967C157.902 486.032 150 505.109 150 525C150 544.891 157.902 563.968 171.967 578.033C186.032 592.098 205.109 600 225 600L225 525V450Z"
                fill="white"
              />
              <path
                d="M300 450C280.109 450 261.032 457.902 246.967 471.967C232.902 486.032 225 505.109 225 525C225 544.891 232.902 563.968 246.967 578.033C261.032 592.098 280.109 600 300 600L300 525V450Z"
                fill="white"
              />
              <path
                d="M300 675C300 716.421 266.421 750 225 750C183.579 750 150 716.421 150 675C150 633.579 183.579 600 225 600C266.421 600 300 633.579 300 675Z"
                fill="white"
              />
            </g>
            <g id="group-03" class="circles">
              <path
                d="M450 75C450 55.1088 442.098 36.0322 428.033 21.967C413.968 7.90176 394.891 1.50175e-06 375 0C355.109 -1.50175e-06 336.032 7.90176 321.967 21.967C307.902 36.0322 300 55.1088 300 75L375 75H450Z"
                fill="white"
              />
              <path
                d="M450 150C450 130.109 442.098 111.032 428.033 96.967C413.968 82.9018 394.891 75 375 75C355.109 75 336.032 82.9018 321.967 96.967C307.902 111.032 300 130.109 300 150L375 150H450Z"
                fill="white"
              />
              <path
                d="M450 225C450 266.421 416.421 300 375 300C333.579 300 300 266.421 300 225C300 183.579 333.579 150 375 150C416.421 150 450 183.579 450 225Z"
                fill="white"
              />
              <path
                d="M375 450C394.891 450 413.968 442.098 428.033 428.033C442.098 413.968 450 394.891 450 375C450 355.109 442.098 336.032 428.033 321.967C413.968 307.902 394.891 300 375 300L375 375V450Z"
                fill="white"
              />
              <path
                d="M300 450C319.891 450 338.968 442.098 353.033 428.033C367.098 413.968 375 394.891 375 375C375 355.109 367.098 336.032 353.033 321.967C338.968 307.902 319.891 300 300 300L300 375V450Z"
                fill="white"
              />
              <path
                d="M450 525C450 566.421 416.421 600 375 600C333.579 600 300 566.421 300 525C300 483.579 333.579 450 375 450C416.421 450 450 483.579 450 525Z"
                fill="white"
              />
              <path
                d="M450 675C450 716.421 416.421 750 375 750C333.579 750 300 716.421 300 675C300 633.579 333.579 600 375 600C416.421 600 450 633.579 450 675Z"
                fill="white"
              />
            </g>
            <g id="group-04" class="circles">
              <path
                d="M600 75C600 116.421 566.421 150 525 150C483.579 150 450 116.421 450 75C450 33.5786 483.579 0 525 0C566.421 0 600 33.5786 600 75Z"
                fill="white"
              />
              <path
                d="M600 225C600 266.421 566.421 300 525 300C483.579 300 450 266.421 450 225C450 183.579 483.579 150 525 150C566.421 150 600 183.579 600 225Z"
                fill="white"
              />
              <path
                d="M600 375C600 355.109 592.098 336.032 578.033 321.967C563.968 307.902 544.891 300 525 300C505.109 300 486.032 307.902 471.967 321.967C457.902 336.032 450 355.109 450 375L525 375H600Z"
                fill="white"
              />
              <path
                d="M600 450C600 430.109 592.098 411.032 578.033 396.967C563.968 382.902 544.891 375 525 375C505.109 375 486.032 382.902 471.967 396.967C457.902 411.032 450 430.109 450 450L525 450H600Z"
                fill="white"
              />
              <path
                d="M600 525C600 566.421 566.421 600 525 600C483.579 600 450 566.421 450 525C450 483.579 483.579 450 525 450C566.421 450 600 483.579 600 525Z"
                fill="white"
              />
              <path
                d="M525 600C534.849 600 544.602 601.94 553.701 605.709C562.801 609.478 571.069 615.003 578.033 621.967C584.997 628.931 590.522 637.199 594.291 646.299C598.06 655.398 600 665.151 600 675C600 684.849 598.06 694.602 594.291 703.701C590.522 712.801 584.997 721.069 578.033 728.033C571.069 734.997 562.801 740.522 553.701 744.291C544.602 748.06 534.849 750 525 750L525 675V600Z"
                fill="white"
              />
              <path
                d="M450 600C459.849 600 469.602 601.94 478.701 605.709C487.801 609.478 496.069 615.003 503.033 621.967C509.997 628.931 515.522 637.199 519.291 646.299C523.06 655.398 525 665.151 525 675C525 684.849 523.06 694.602 519.291 703.701C515.522 712.801 509.997 721.069 503.033 728.033C496.069 734.997 487.801 740.522 478.701 744.291C469.602 748.06 459.849 750 450 750L450 675V600Z"
                fill="white"
              />
            </g>
          </g>
        </mask>
      </defs>
      <image
        xlink:href="~/assets/img/main-img/a-img-03.jpg"
        width="600"
        height="750"
        mask="url(#mask-group)"
        class="svg-img"
        :class="{ show: counter == 1 }"
      ></image>
      <image
        xlink:href="~/assets/img/main-img/a-img-01.jpg"
        width="600"
        height="750"
        mask="url(#mask-group)"
        class="svg-img"
        :class="{ show: counter == 2 }"
      ></image>
      <image
        xlink:href="~/assets/img/main-img/a-img-02.jpg"
        width="600"
        height="750"
        mask="url(#mask-group)"
        class="svg-img"
        :class="{ show: counter == 3 }"
      ></image>
      <image
        xlink:href="~/assets/img/main-img/a-img-04.jpg"
        width="600"
        height="750"
        mask="url(#mask-group)"
        class="svg-img"
        :class="{ show: counter == 4 }"
      ></image>
      <image
        xlink:href="~/assets/img/main-img/a-img-05.jpg"
        width="600"
        height="750"
        mask="url(#mask-group)"
        class="svg-img"
        :class="{ show: counter == 5 }"
      ></image>
    </svg>
  </div>
</template>

<script setup>
  import gsap from 'gsap'

  const props = defineProps({
    ready: Boolean,
  })

  const counter = ref(1)
  const circlesGroup = ref(null)
  const textBlob = ref(null)
  let tl
  let ctx

  const changeImg = () => {
    ++counter.value
    if (counter.value > 5) {
      counter.value = 1
    }
  }

  watch(
    () => props.ready,
    newVal => {
      if (newVal) {
        ctx = gsap.context(self => {
          const targets = self.selector('.circles').reverse()
          tl = gsap.timeline({
            repeat: -1,
            yoyo: true,
            repeatDelay: 2.5,
            onRepeat() {
              let isAtStartingPos = this.iteration() % 2 === 0
              if (isAtStartingPos) {
                changeImg()
              }
            },
          })
          tl.set(targets, { x: 0, opacity: 1 })

          tl.to(targets, {
            xPercent: -400,
            duration: 1.5,
            stagger: 0.3,
            ease: 'expo.in',
          })
          tl.to(textBlob.value, { opacity: 1, scale: 0.8, duration: 0.5 })
        }, circlesGroup.value)
      }
    }
  )

  onBeforeUnmount(() => {
    ctx.revert()
    counter.value = 0
  })
</script>
